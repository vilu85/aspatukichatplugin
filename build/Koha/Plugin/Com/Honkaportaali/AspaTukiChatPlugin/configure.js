var error,btnEnableChat,btnDisableChat,btnPurgeMessages,btnPurgeMessagesOlder,btnPurgeUsers,btnPurgeUsersOlder,payload={};function Button(e,n,s,t){this.btnObject=$("#"+e),this.spinnerObject=$("#"+n),this.isDisabled=!1,this.feedbackObject=$("#"+s),$("#"+e).click(t),$("#"+s).on("show",(function(e){var n=$(e.currentTarget);n.addClass("animated flash"),n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",(function(){$(this).hide(),$(this).removeClass("animated flash")}))})),this.setEnabled=function(e){e||this.spinnerObject.hide(),this.isDisabled=!e,this.btnObject.disabled=!e,e?this.btnObject.removeClass("disabled"):this.btnObject.addClass("disabled")},this.showSpinner=function(e){e?this.spinnerObject.show():(this.spinnerObject.hide(),this.feedbackObject.hide())},this.showFeedback=function(){this.feedbackObject.show()}}function saveMotd(e){btnSaveMotd.showSpinner(!0),send({motd:e},"savemotd",(function(e){"saved"==e.status&&(btnSaveMotd.showSpinner(!1),$("#txtMotd").text(e.data),btnSaveMotd.showFeedback())}),(function(){btnSaveMotd.showSpinner(!1)}))}function enableChat(e){btnEnableChat.showSpinner(e),btnDisableChat.showSpinner(!e),send({enable:e?1:0},"enable_chat",(function(n){"enabled"==n.status&&(btnEnableChat.setEnabled(!e),btnDisableChat.setEnabled(e),btnEnableChat.showFeedback()),"disabled"==n.status&&(btnDisableChat.setEnabled(!e),btnEnableChat.setEnabled(e),btnDisableChat.showFeedback())}),(function(){btnEnableChat.showSpinner(!1),btnDisableChat.showSpinner(!1),payload={username:$(".loggedinusername").html()},send_data(payload,"login",onLogin)}))}function purgeMessages(e){btnPurgeMessages.showSpinner(e),btnPurgeMessagesOlder.showSpinner(!e),send({olderthan:e?7:86400},"purge_messages",(function(e){"purged"==e.status&&(btnPurgeMessages.showSpinner(!1),btnPurgeMessagesOlder.showSpinner(!1),$("#messageCount").text(e.data),btnPurgeMessages.showFeedback())}),(function(){btnPurgeMessages.showSpinner(!1),btnPurgeMessagesOlder.showSpinner(!1)}))}function purgeUsers(e){btnPurgeUsers.showSpinner(e),btnPurgeUsersOlder.showSpinner(!e),send({olderthan:e?7:86400},"purge_users",(function(e){"purged"==e.status&&(btnPurgeUsers.showSpinner(!1),btnPurgeUsersOlder.showSpinner(!1),$("#userCount").text(e.data),btnPurgeUsers.showFeedback())}),(function(){btnPurgeUsers.showSpinner(!1),btnPurgeUsersOlder.showSpinner(!1)}))}function send(e,n,s,t){console.log("send()");var a={};a.userdata=JSON.stringify(e),a.class="Koha::Plugin::Com::Honkaportaali::AspaTukiChatPlugin",a.method="tool",a.sub=n,$.ajax({type:"POST",url:"/cgi-bin/koha/plugins/run.pl",data:a,success:s,dataType:"json"}).done(t).fail((function(e,n){alert("Error: "+n)}))}$(document).ready((function(){btnEnableChat=new Button("enableChatBtn","spinnerEnableBtn","enableDisableChatFeedback",(function(){enableChat(!0)})),btnDisableChat=new Button("disableChatBtn","spinnerDisableBtn","enableDisableChatFeedback",(function(){enableChat(!1)})),btnPurgeMessages=new Button("purgeAllMessages","spinnerPurgeMessagesAll","purgeMessagesFeedback",(function(){purgeMessages(!0)})),btnPurgeMessagesOlder=new Button("purgeOlderMessages","spinnerPurgeMessagesOlder","purgeMessagesFeedback",(function(){purgeMessages(!1)})),btnPurgeUsers=new Button("purgeAllUsers","spinnerPurgeUsersAll","purgeUsersFeedback",(function(){purgeUsers(!0)})),btnPurgeUsersOlder=new Button("purgeOlderUsers","spinnerPurgeUsersOlder","purgeUsersFeedback",(function(){purgeUsers(!1)})),btnSaveMotd=new Button("saveMotd","spinnerSaveMotd","saveMotdFeedback",(function(){saveMotd($("#txtMotd").val())}))}));